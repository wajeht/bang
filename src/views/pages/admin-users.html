<section style="display: flex; flex-direction: column; gap: 30px;">
  <header style="display: flex; justify-content: space-between; align-items: center;">
    <div>
      <h2>ğŸ‘¥ Users</h2>
      <p>Manage application users</p>
    </div>

    <div style="display: flex; gap: 10px;">
      <form method="GET" style="display: flex; gap: 10px;" role="search">
        <label for="search-input" style="position: absolute; left: -10000px;">Search users</label>
        <input
          type="search"
          id="search-input"
          name="search"
          placeholder="Search users..."
          value="<%= search %>"
          style="padding: 8px; border-radius: 5px; border: 1px solid; flex: 1;"
        >
        <button type="submit">ğŸ” Search</button>
      </form>
    </div>
  </header>

  <div style="border-style: solid; border-radius: 5px; padding: 20px; display: flex; flex-direction: column; gap: 10px;">
    <% if (data && data.length > 0) { %>
      <table style="width: 100%; border-collapse: collapse;">
        <caption style="position: absolute; left: -10000px;"><%= data.length %> users found</caption>
        <thead>
          <tr style="border-bottom: 1px solid #ddd;">
            <th scope="col" style="text-align: left; padding: 10px;">
              <a href="/admin/users?page=<%= pagination.currentPage %>&per_page=<%= pagination.perPage %>&sort_key=username&direction=<%= (sortKey === 'username' && direction === 'asc') ? 'desc' : 'asc' %>&search=<%= search %>"
                style="text-decoration: none; color: inherit; display: flex; align-items: center; gap: 5px;">
                ğŸ‘¤ Username
                <% if (sortKey === 'username') { %>
                  <%= direction === 'asc' ? 'ğŸ”¼' : 'ğŸ”½' %>
                <% } else { %>
                  <span class="sort-icon">âºï¸</span>
                <% } %>
              </a>
            </th>
            <th scope="col" style="text-align: left; padding: 10px;">
              <a href="/admin/users?page=<%= pagination.currentPage %>&per_page=<%= pagination.perPage %>&sort_key=email&direction=<%= (sortKey === 'email' && direction === 'asc') ? 'desc' : 'asc' %>&search=<%= search %>"
                style="text-decoration: none; color: inherit; display: flex; align-items: center; gap: 5px;">
                ğŸ“§ Email
                <% if (sortKey === 'email') { %>
                  <%= direction === 'asc' ? 'ğŸ”¼' : 'ğŸ”½' %>
                <% } else { %>
                  <span class="sort-icon">âºï¸</span>
                <% } %>
              </a>
            </th>
            <th scope="col" style="text-align: left; padding: 10px;">
              <a href="/admin/users?page=<%= pagination.currentPage %>&per_page=<%= pagination.perPage %>&sort_key=is_admin&direction=<%= (sortKey === 'is_admin' && direction === 'asc') ? 'desc' : 'asc' %>&search=<%= search %>"
                style="text-decoration: none; color: inherit; display: flex; align-items: center; gap: 5px;">
                ğŸ‘‘ Admin
                <% if (sortKey === 'is_admin') { %>
                  <%= direction === 'asc' ? 'ğŸ”¼' : 'ğŸ”½' %>
                <% } else { %>
                  <span class="sort-icon">âºï¸</span>
                <% } %>
              </a>
            </th>
            <th scope="col" style="text-align: left; padding: 10px;">
              <a href="/admin/users?page=<%= pagination.currentPage %>&per_page=<%= pagination.perPage %>&sort_key=email_verified_at&direction=<%= (sortKey === 'email_verified_at' && direction === 'asc') ? 'desc' : 'asc' %>&search=<%= search %>"
                style="text-decoration: none; color: inherit; display: flex; align-items: center; gap: 5px;">
                âœ… Email Verified
                <% if (sortKey === 'email_verified_at') { %>
                  <%= direction === 'asc' ? 'ğŸ”¼' : 'ğŸ”½' %>
                <% } else { %>
                  <span class="sort-icon">âºï¸</span>
                <% } %>
              </a>
            </th>
            <th scope="col" style="text-align: left; padding: 10px;">
              <a href="/admin/users?page=<%= pagination.currentPage %>&per_page=<%= pagination.perPage %>&sort_key=created_at&direction=<%= (sortKey === 'created_at' && direction === 'asc') ? 'desc' : 'asc' %>&search=<%= search %>"
                style="text-decoration: none; color: inherit; display: flex; align-items: center; gap: 5px;">
                ğŸ“… Created
                <% if (sortKey === 'created_at') { %>
                  <%= direction === 'asc' ? 'ğŸ”¼' : 'ğŸ”½' %>
                <% } else { %>
                  <span class="sort-icon">âºï¸</span>
                <% } %>
              </a>
            </th>
            <th scope="col" style="text-align: left; padding: 10px;">âš¡ Actions</th>
          </tr>
        </thead>
        <tbody>
          <% data.forEach(function(user) { %>
            <tr style="border-bottom: 1px solid #ddd;">
              <td style="padding: 10px;"><%= user.username %></td>
              <td style="padding: 10px;"><%= user.email %></td>
              <td style="padding: 10px;"><%= user.is_admin ? 'âœ…' : 'âŒ' %></td>
              <td style="padding: 10px;"><%= user.email_verified_at ? 'âœ…' : 'âŒ' %></td>
              <td style="padding: 10px;"><time datetime="<%= user.created_at %>"><%= new Date(user.created_at).toLocaleDateString() %></time></td>
              <td style="padding: 10px;">
                <div style="display: flex; gap: 10px;">
                  <button type="button" style="background: none; border: none; padding: 0; font: inherit; cursor: pointer; text-decoration: underline; color: inherit;" onclick="document.getElementById('delete-user-<%= user.id %>-modal').showModal()" aria-label="Delete user <%= user.username %>">
                    ğŸ—‘ï¸ Delete
                  </button>

                  <dialog id="delete-user-<%= user.id %>-modal" aria-labelledby="delete-user-<%= user.id %>-title">
                    <h2 id="delete-user-<%= user.id %>-title">Confirm</h2>
                    <p>Are you sure you want to delete this user?</p>
                    <form action="/admin/users/<%= user.id %>/delete" method="POST">
                      <input type="hidden" id="csrfToken" name="csrfToken" value="<%= csrfToken %>" />
                      <div style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px;">
                        <button type="button" onclick="this.closest('dialog').close()">âŒ Cancel</button>
                        <button type="submit">ğŸ—‘ï¸ Delete</button>
                      </div>
                    </form>
                  </dialog>
                </div>
              </td>
            </tr>
          <% }); %>
        </tbody>
      </table>
    <% } else { %>
      <div style="text-align: center; padding: 20px;">
        <% if (search) { %>
          <p>ğŸ” No users found matching "<%= search %>"</p>
          <p>Try a different search term or <a href="/admin/users">view all users</a></p>
        <% } else { %>
          <p>ğŸ“­ No users found.</p>
        <% } %>
      </div>
    <% } %>
  </div>
</section>
