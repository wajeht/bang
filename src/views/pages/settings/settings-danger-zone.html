<section style="display: flex; flex-direction: column; gap: 20px; max-width: 100%;">

  <header style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap;">
    <div style="display: flex; flex-direction: column; gap: 5px;">
      <h2 style="margin: 0;">âš ï¸ Danger Zone</h2>
      <p>These actions permanently delete your data and cannot be undone.</p>
    </div>
  </header>

  <fieldset style="width: 32.5%; max-width: 32.5%; min-width: 0; box-sizing: border-box; display: flex; flex-direction: column; gap: 10px;">
    <legend>ğŸ—‘ï¸ Bulk Delete Data</legend>
    <p>Permanently delete selected data types</p>
    <button type="button" onclick="document.getElementById('bulk-delete-modal').showModal()" aria-label="Bulk delete data">ğŸ—‘ï¸ Bulk Delete Data</button>
  </fieldset>

  <fieldset style="width: 32.5%; max-width: 32.5%; min-width: 0; box-sizing: border-box; display: flex; flex-direction: column; gap: 10px;">
    <legend>â˜ ï¸ Delete Account</legend>
    <p>Delete your account and all data permanently</p>
    <button type="button" onclick="document.getElementById('delete-users-<%= user.id %>-modal').showModal()" aria-label="Delete your account">ğŸ—‘ï¸ Delete my account</button>

    <dialog id="delete-users-<%= user.id %>-modal" aria-labelledby="delete-user-<%= user.id %>-title">
      <h2 id="delete-user-<%= user.id %>-title">Confirm Account Deletion</h2>
      <div style="margin-bottom: 20px;">
        <p><strong>Are you sure you want to delete your account?</strong></p>
        <p style="color: #d73502; margin-top: 10px;">âš ï¸ <strong>Warning:</strong> Deleted data cannot be recovered!</p>
        <p style="margin-top: 15px;">Export your data before deletion (optional):</p>

        <form method="POST" action="/settings/danger-zone/delete">
          <input type="hidden" id="csrfToken" name="csrfToken" value="<%= csrfToken %>" />

          <fieldset style="margin: 15px 0;">
            <legend>ğŸ“§ Email Export Options (Optional)</legend>

            <div style="display: flex; flex-direction: column; gap: 5px;">
              <%- include('../../components/inputs/checkbox.html', {
                id: 'json-export-checkbox',
                name: 'export_options[]',
                value: 'json',
                label: 'ğŸ“¦ Send complete JSON export (bookmarks, actions, notes, reminders, preferences)'
              }) %>

              <%- include('../../components/inputs/checkbox.html', {
                id: 'html-export-checkbox',
                name: 'export_options[]',
                value: 'html',
                label: 'ğŸ”– Send HTML bookmarks file (compatible with browsers)'
              }) %>
            </div>

            <p style="margin-top: 10px;">
              <em>If no options are selected, your account will be deleted without sending any exports.</em>
            </p>
          </fieldset>

          <fieldset style="margin: 15px 0;">
            <legend>âš ï¸ Confirmation Required</legend>
            <%- include('../../components/inputs/text.html', {
              id: 'delete-account-confirmation',
              name: 'confirmation',
              label: 'To confirm account deletion, type DELETE ACCOUNT below:',
              placeholder: 'Type DELETE ACCOUNT to confirm',
              required: true,
              style: 'width: 100%;'
            }) %>
          </fieldset>

          <div style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px;">
            <button type="button" onclick="this.closest('dialog').close()">âŒ Cancel</button>
            <button type="submit">ğŸ—‘ï¸ Delete Account</button>
          </div>
        </form>
      </div>
    </dialog>

    <dialog id="bulk-delete-modal" aria-labelledby="bulk-delete-title">
      <h2 id="bulk-delete-title">Bulk Delete Data</h2>
      <div style="margin-bottom: 20px;">
        <p><strong>Choose which data to permanently delete:</strong></p>
        <p style="color: #d73502; margin-top: 10px;">âš ï¸ <strong>Warning:</strong> Deleted data cannot be recovered!</p>

        <form method="POST" action="/settings/danger-zone/bulk-delete">
          <input type="hidden" id="csrfToken" name="csrfToken" value="<%= csrfToken %>" />

          <fieldset style="margin: 15px 0;">
            <legend>ğŸ—‘ï¸ Select Data Types to Delete</legend>

            <div style="display: flex; flex-direction: column; gap: 8px;">
              <%- include('../../components/inputs/checkbox.html', {
                id: 'delete-actions-checkbox',
                name: 'delete_options[]',
                value: 'actions',
                label: 'âš¡ Delete all actions'
              }) %>

              <%- include('../../components/inputs/checkbox.html', {
                id: 'delete-tabs-checkbox',
                name: 'delete_options[]',
                value: 'tabs',
                label: 'ğŸ“‘ Delete all tabs'
              }) %>

              <%- include('../../components/inputs/checkbox.html', {
                id: 'delete-bookmarks-checkbox',
                name: 'delete_options[]',
                value: 'bookmarks',
                label: 'ğŸ”– Delete all bookmarks'
              }) %>

              <%- include('../../components/inputs/checkbox.html', {
                id: 'delete-notes-checkbox',
                name: 'delete_options[]',
                value: 'notes',
                label: 'ğŸ“ Delete all notes'
              }) %>

              <%- include('../../components/inputs/checkbox.html', {
                id: 'delete-reminders-checkbox',
                name: 'delete_options[]',
                value: 'reminders',
                label: 'â° Delete all reminders'
              }) %>

              <%- include('../../components/inputs/checkbox.html', {
                id: 'delete-api-keys-checkbox',
                name: 'delete_options[]',
                value: 'api_keys',
                label: 'ğŸ”‘ Delete all API keys'
              }) %>
            </div>

            <p style="margin-top: 10px;">
              <em>Only selected items will be deleted. Your account remains active.</em>
            </p>
          </fieldset>

          <fieldset id="bulk-delete-confirmation" style="margin: 15px 0; display: none;">
            <legend>âš ï¸ Confirmation Required</legend>
            <%- include('../../components/inputs/text.html', {
              id: 'bulk-delete-confirmation-input',
              name: 'confirmation',
              label: 'To confirm bulk deletion, type DELETE DATA below:',
              placeholder: 'Type DELETE DATA to confirm',
              required: false,
              style: 'width: 100%;'
            }) %>
          </fieldset>

          <div style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px;">
            <button type="button" onclick="this.closest('dialog').close()">âŒ Cancel</button>
            <button type="submit">ğŸ—‘ï¸ Delete Selected Data</button>
          </div>
        </form>
      </div>
    </dialog>

  </fieldset>

</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const bulkDeleteModal = document.getElementById('bulk-delete-modal');
  const confirmationFieldset = document.getElementById('bulk-delete-confirmation');
  const confirmationInput = document.getElementById('bulk-delete-confirmation-input');
  const submitButton = bulkDeleteModal.querySelector('button[type="submit"]');

  const checkboxes = [
    'delete-actions-checkbox',
    'delete-tabs-checkbox',
    'delete-bookmarks-checkbox',
    'delete-notes-checkbox',
    'delete-reminders-checkbox',
    'delete-api-keys-checkbox'
  ].map(id => document.getElementById(id));

  function updateConfirmationVisibility() {
    const allSelected = checkboxes.every(checkbox => checkbox.checked);

    if (allSelected) {
      confirmationFieldset.style.display = 'block';
      confirmationInput.setAttribute('required', 'true');
      submitButton.disabled = false;
    } else {
      confirmationFieldset.style.display = 'none';
      confirmationInput.removeAttribute('required');
      confirmationInput.value = '';
      submitButton.disabled = false;
    }
  }

  checkboxes.forEach(checkbox => {
    if (checkbox) {
      checkbox.addEventListener('change', updateConfirmationVisibility);
    }
  });

  updateConfirmationVisibility();
});
</script>
