<section style="display: flex; flex-direction: column; gap: 30px;">
    <header>
        <h2>‚è∞ Reminders / <%= reminder.id %> / Edit</h2>
        <p>Edit your reminder</p>
    </header>

    <form
        method="POST"
        action="/reminders/<%= reminder.id %>/update"
        style="width: 32.5%; display: flex; flex-direction: column; gap: 10px;"
    >
        <fieldset style="display: flex; flex-direction: column;">
            <legend>Edit <%= reminder.title %></legend>

            <input type="hidden" name="csrfToken" value="<%= csrfToken %>" />

            <%- include('../../components/inputs/text.html', {
                id: 'title',
                name: 'title',
                label: 'üìù Title',
                placeholder: 'Take out trash',
                value: state.input && state.input.title ? state.input.title : reminder.title,
                required: true,
                helpText: 'What do you want to be reminded about?',
                error: state.errors && state.errors.title ? state.errors.title : undefined
            }) %>

            <%- include('../../components/inputs/textarea.html', {
                id: 'content',
                name: 'content',
                label: 'üìù Content (optional)',
                placeholder: 'https://example.com or any text',
                value: state.input && state.input.content ? state.input.content : (reminder.content || ''),
                required: false,
                helpText: 'Optional content like a URL or additional notes',
                error: state.errors && state.errors.content ? state.errors.content : undefined
            }) %>

            <%- include('../../components/inputs/select.html', {
                id: 'when',
                name: 'when',
                label: '‚è∞ When',
                required: true,
                value: state.input && state.input.when ? state.input.when : (reminder.reminder_type === 'recurring' ? reminder.frequency : 'tomorrow'),
                options: timingOptions,
                helpText: 'When should you be reminded? Choose from preset options or select Custom Date for a specific date.',
                error: state.errors && state.errors.when ? state.errors.when : undefined
            }) %>

            <%- include('../../components/inputs/date.html', {
                id: 'custom_date',
                name: 'custom_date',
                label: 'üìÖ Custom Date',
                value: reminder.next_due ? new Date(reminder.next_due).toISOString().split('T')[0] : new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                required: false,
                helpText: 'Select a specific date (only shown when Custom Date is selected)',
                error: undefined,
                style: 'display: none;'
            }) %>

            <%- include('../../components/inputs/checkbox.html', {
                id: 'is_completed',
                name: 'is_completed',
                label: '‚úÖ Mark as completed',
                checked: reminder.is_completed ? true : false,
                helpText: 'Mark this reminder as completed',
                error: state.errors && state.errors.is_completed ? state.errors.is_completed : undefined
            }) %>

        </fieldset>

        <div style="display: flex; justify-content: flex-end; gap: 10px;">
            <button type="button" onclick="location.href='/reminders'">‚ùå Cancel</button>
            <button type="submit">üíæ Save</button>
        </div>
    </form>

    <script>
        const whenSelect = document.getElementById('when');
        const customDateContainer = document.getElementById('custom_date').closest('div');

        function toggleCustomDateField() {
            if (whenSelect.value === 'custom') {
                customDateContainer.style.display = 'block';
                document.getElementById('custom_date').required = true;
            } else {
                customDateContainer.style.display = 'none';
                document.getElementById('custom_date').required = false;
            }
        }

        whenSelect.addEventListener('change', toggleCustomDateField);
        
        // Initialize on page load
        toggleCustomDateField();
    </script>

</section>
