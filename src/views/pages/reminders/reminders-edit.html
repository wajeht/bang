<section style="display: flex; flex-direction: column; gap: 30px;">
    <header>
        <h2>‚è∞ Reminders / <%= reminder.id %> / Edit</h2>
        <p>Edit your reminder</p>
    </header>

    <form
        method="POST"
        action="/reminders/<%= reminder.id %>/update"
        style="width: 32.5%; display: flex; flex-direction: column; gap: 10px;"
    >
        <fieldset style="display: flex; flex-direction: column;">
            <legend>Edit <%= reminder.title %></legend>

            <input type="hidden" name="csrfToken" value="<%= csrfToken %>" />

            <%- include('../../components/inputs/text.html', {
                id: 'title',
                name: 'title',
                label: 'üìù Title',
                placeholder: 'Take out trash',
                value: state.input && state.input.title ? state.input.title : reminder.title,
                required: true,
                helpText: 'What do you want to be reminded about?',
                error: state.errors && state.errors.title ? state.errors.title : undefined
            }) %>

            <%- include('../../components/inputs/url.html', {
                id: 'url',
                name: 'url',
                label: 'üîó URL (optional)',
                placeholder: 'https://example.com',
                value: state.input && state.input.url ? state.input.url : (reminder.url || ''),
                required: false,
                helpText: 'Optional link to open with this reminder',
                error: state.errors && state.errors.url ? state.errors.url : undefined
            }) %>

            <%- include('../../components/inputs/select.html', {
                id: 'reminder_type',
                name: 'reminder_type',
                label: 'üîÑ Type',
                required: true,
                value: state.input && state.input.reminder_type ? state.input.reminder_type : reminder.reminder_type,
                options: [
                    { value: 'once', label: 'One-time reminder' },
                    { value: 'recurring', label: 'Recurring reminder' }
                ],
                helpText: 'Choose if this reminder should repeat',
                error: state.errors && state.errors.reminder_type ? state.errors.reminder_type : undefined
            }) %>

            <%- include('../../components/inputs/select.html', {
                id: 'frequency',
                name: 'frequency',
                label: 'üìÖ Frequency',
                required: false,
                value: state.input && state.input.frequency ? state.input.frequency : (reminder.frequency || ''),
                options: [
                    { value: '', label: 'None (one-time only)' },
                    { value: 'daily', label: 'Daily' },
                    { value: 'weekly', label: 'Weekly' },
                    { value: 'biweekly', label: 'Bi-weekly (every 2 weeks)' },
                    { value: 'monthly', label: 'Monthly' }
                ],
                helpText: 'How often should this reminder repeat? (only for recurring reminders)',
                error: state.errors && state.errors.frequency ? state.errors.frequency : undefined
            }) %>

            <%- include('../../components/inputs/date.html', {
                id: 'next_due',
                name: 'next_due',
                label: 'üìÜ Due Date',
                value: state.input && state.input.next_due ? state.input.next_due : (reminder.next_due ? new Date(reminder.next_due).toISOString().split('T')[0] : ''),
                required: true,
                helpText: 'When should this reminder be due?',
                error: state.errors && state.errors.next_due ? state.errors.next_due : undefined
            }) %>

            <%- include('../../components/inputs/select.html', {
                id: 'category',
                name: 'category',
                label: 'üìÇ Category',
                required: true,
                value: state.input && state.input.category ? state.input.category : reminder.category,
                options: [
                    { value: 'auto', label: 'ü§ñ Auto-detect' },
                    { value: 'task', label: 'üìù Task' },
                    { value: 'reading', label: 'üìñ Reading' },
                    { value: 'link', label: 'üîó Link' }
                ],
                helpText: 'What type of reminder is this?',
                error: state.errors && state.errors.category ? state.errors.category : undefined
            }) %>

            <%- include('../../components/inputs/checkbox.html', {
                id: 'is_completed',
                name: 'is_completed',
                label: '‚úÖ Mark as completed',
                checked: reminder.is_completed ? true : false,
                helpText: 'Mark this reminder as completed',
                error: state.errors && state.errors.is_completed ? state.errors.is_completed : undefined
            }) %>

        </fieldset>

        <div style="display: flex; justify-content: flex-end; gap: 10px;">
            <button type="button" onclick="location.href='/reminders'">‚ùå Cancel</button>
            <button type="submit">üíæ Save</button>
        </div>
    </form>

    <script>
        // Show/hide frequency field based on reminder type
        const reminderTypeSelect = document.getElementById('reminder_type');
        const frequencySelect = document.getElementById('frequency');
        const frequencyContainer = frequencySelect.closest('div');

        function toggleFrequencyField() {
            if (reminderTypeSelect.value === 'recurring') {
                frequencyContainer.style.display = 'block';
                frequencySelect.required = true;
            } else {
                frequencyContainer.style.display = 'none';
                frequencySelect.required = false;
                frequencySelect.value = '';
            }
        }

        reminderTypeSelect.addEventListener('change', toggleFrequencyField);

        // Initialize on page load
        toggleFrequencyField();
    </script>
</section>
