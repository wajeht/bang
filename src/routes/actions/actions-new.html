<section style="display: flex; flex-direction: column; gap: 30px;">
    <header>
        <h2>ğŸš€ Actions / New</h2>
        <p>Create a new action</p>
    </header>

    <form
        method="POST"
        action="/actions"
        style="width: 32.5%; display: flex; flex-direction: column; gap: 10px;"
    >
        <fieldset style="display: flex; flex-direction: column; background-color: var(--background-color);">
            <legend>Action Details</legend>

            <input type="hidden" id="csrfToken" name="csrfToken" value="<%= csrfToken %>" />

            <%~ include('../_components/inputs/text.html', {
                id: 'name',
                name: 'name',
                label: 'ğŸ“ Name',
                placeholder: 'Google Search',
                value: state.input && state.input.name ? state.input.name : '',
                required: true,
                helpText: 'A descriptive name for your action',
                error: state.errors && state.errors.name ? state.errors.name : undefined
            }) %>

            <%~ include('../_components/inputs/text.html', {
                id: 'trigger',
                name: 'trigger',
                label: 'âš¡ Trigger',
                placeholder: 'g',
                value: state.input && state.input.trigger ? state.input.trigger : '',
                required: true,
                helpText: 'The command to trigger this action (e.g., "g" for Google)',
                error: state.errors && state.errors.trigger ? state.errors.trigger : undefined
            }) %>

            <%~ include('../_components/inputs/url.html', {
                id: 'url',
                name: 'url',
                label: 'ğŸŒ URL',
                placeholder: 'https://google.com/search?q={query}',
                value: state.input && state.input.url ? state.input.url : '',
                required: true,
                helpText: 'For search actions, use {query} where the search term should go',
                error: state.errors && state.errors.url ? state.errors.url : undefined
            }) %>

            <%~ include('../_components/inputs/select.html', {
                id: 'actionType',
                name: 'actionType',
                label: 'ğŸ·ï¸ Action Type',
                options: actionTypes.map(type => ({
                    value: type,
                    text: type.charAt(0).toUpperCase() + type.slice(1),
                    selected: (state.input && state.input.actionType ? state.input.actionType : actionTypes[0]) === type
                })),
                required: true,
                helpText: 'Select the type of action to perform',
                error: state.errors && state.errors.actionType ? state.errors.actionType : undefined,
                onchange: "var hiddenCheckbox = document.getElementById('hidden-section'); if(this.value === 'redirect') { hiddenCheckbox.style.display = 'block'; } else { hiddenCheckbox.style.display = 'none'; document.getElementById('hidden').checked = false; }"
            }) %>

            <div id="hidden-section" style="display: <%= (state.input && state.input.actionType === 'redirect') || (!state.input || !state.input.actionType) ? 'block' : 'none' %>;">
                <%~ include('../_components/inputs/checkbox.html', {
                    id: 'hidden',
                    name: 'hidden',
                    label: 'ğŸ”’ Hide this action',
                    checked: state.input && state.input.hidden === 'on' ? true : false,
                    helpText: 'Hidden redirect actions are excluded from searches and require your global password to view',
                    error: state.errors && state.errors.hidden ? state.errors.hidden : undefined
                }) %>
            </div>
        </fieldset>

        <div style="display: flex; justify-content: flex-end; gap: 10px; margin-top: 10px;">
            <button type="button" onclick="location.href='/actions'">âŒ Cancel</button>
            <button type="submit">ğŸ’¾ Save</button>
        </div>
    </form>
</section>
