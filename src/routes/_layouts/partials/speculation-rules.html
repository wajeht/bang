<script>
	if (HTMLScriptElement.supports && HTMLScriptElement.supports("speculationrules")) {
		const specScript = document.createElement("script");
		specScript.type = "speculationrules";

		// AGGRESSIVE SPECULATION RULES - Maximum Speed Configuration
		// Chrome limits (2025): eager = 10 prerender, 50 prefetch
		const specRules = {
			// === PRERENDER RULES ===
			// Full page rendering - instant 0ms navigation
			"prerender": [
				{
					// Top pages get immediate prerender on hover
					"urls": ["/actions", "/bookmarks", "/notes", "/tabs", "/reminders"],
					"eagerness": "eager" // Triggers immediately on hover - no delay
				},
				{
					// Prerender detail pages on hover
					"where": {
						"and": [
							{ "href_matches": "/*" },
							{ "not": { "href_matches": "/api/*" } },
							{ "not": { "href_matches": "/logout" } },
							{ "not": { "selector_matches": "[data-no-prerender]" } }
						]
					},
					"eagerness": "moderate" // 200ms hover for other internal links
				}
			],

			// === PREFETCH RULES ===
			// Catch-all: prefetch ANY same-origin link on hover
			"prefetch": [
				{
					// Prefetch all internal links immediately on hover
					"where": {
						"and": [
							{ "href_matches": "/*" },
							{ "not": { "href_matches": "/api/*" } },
							{ "not": { "href_matches": "/logout" } },
							{ "not": { "selector_matches": "[data-no-prefetch]" } }
						]
					},
					"eagerness": "eager" // No delay - prefetch starts immediately on hover
				}
			]
		};

		specScript.textContent = JSON.stringify(specRules);
		document.head.appendChild(specScript);

		console.log('âœ… Speculation rules added:', specRules);
		console.log('ğŸ” Debug: Check DevTools > Application > Speculative loads');

		if (document.prerendering) {
			console.log('ğŸš€ Page is being prerendered!');
			document.addEventListener("prerenderingchange", () => {
				console.log('âš¡ Page activated from prerender!', {
					activationStart: performance.getEntriesByType('navigation')[0]?.activationStart
				});
			}, { once: true });
		}

		document.addEventListener('DOMContentLoaded', () => {
			const nav = performance.getEntriesByType('navigation')[0];
			if (nav?.activationStart > 0) {
				console.log('ğŸ“Š Prerendered! Activation:', nav.activationStart + 'ms');
			}
		});

	} else {
		console.log('âŒ Speculation rules not supported');
	}
</script>
